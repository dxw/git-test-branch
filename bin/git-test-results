#!/bin/sh
set -e

COMMITS=${1}

if test "${COMMITS}" = ""; then
  echo "Usage: git test-results origin/HEAD..@"
fi

for COMMIT in $(git rev-list "${COMMITS}"); do
  HASH=$(git log -1 --format=%h "${COMMIT}")
  RESULT=$(git notes --ref=refs/notes/dxw-git-test-commit show "${COMMIT}" 2>/dev/null || echo WAITING)
  SUBJECT=$(git log -1 --format=%s "${COMMIT}")

  echo "${HASH} [${RESULT}] ${SUBJECT}"
done
