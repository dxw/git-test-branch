#!/bin/sh
set -e

COMMITS=${1}
COMMAND=${2}

if test "${COMMITS}" = ""; then
  echo "Usage: git test-branch origin/HEAD..@ 'command-to-run'"
  exit 1
fi

if test "${COMMAND}" = ""; then
  echo "Usage: git test-branch origin/HEAD..@ 'command-to-run'"
  exit 1
fi

git rev-list "${COMMITS}" | xargs --max-procs=5 -I {} git test-commit {} "${COMMAND}" >/dev/null 2>&1
git test-results "${COMMITS}"
